64-bit Uniform Instruction Format Proposal
==========================================

This is a proposal to have a 64-bit instruction that all shorter instructions
can be translated to, such that the internal representation used in a CPU can
be this 64-bit format.

The instruction format is designed for ease of decoding, rather than encoding
density.

Conventions
===========

Conventions used in this document:
- Bits are numbered starting from 0 at the LSB, so bit 3 is 1 in the integer 8.
- Bit ranges are inclusive on both ends, so 5:3 means bits 5, 4, and 3.

Operations work on variable-length vectors of sub-vectors, where each sub-vector
has a length *svlen*, and an element type *etype*. When the vectors are stored
in registers, all elements are packed so that there is no padding in-between
elements of the same vector. The number of bytes in a sub-vector, *svsz*, is the
product of *svlen* and the element size in bytes.

Register Fields
===============

+---------------------+-----------------+
| 7                   | 6:0             |
+=====================+=================+
| Float (1) / Int (0) | Register Number |
+---------------------+-----------------+

Predicate (pred)
================

+-------------------+---------------------------+
| 5                 | 4:0                       |
+===================+===========================+
| Matched Bit Value | Predicate Register (preg) |
+-------------------+---------------------------+

+----------+----------------+
| Encoding |                |
+==========+================+
| 000000   | *Unpredicated* |
+----------+----------------+
| 100000   | *Reserved*     |
+----------+----------------+
| 000001   | ``!x1``        |
| \.\.\.   | \.\.\.         |
| 011111   | ``!x31``       |
+----------+----------------+
| 100001   | x1             |
| \.\.\.   | \.\.\.         |
| 111111   | x31            |
+----------+----------------+

Sub-Vector Length (svlen) Field Encoding
========================================

+----------------+-------+
| svlen Encoding | Value |
+================+=======+
| 00             | 4     |
+----------------+-------+
| 01             | 1     |
+----------------+-------+
| 10             | 2     |
+----------------+-------+
| 11             | 3     |
+----------------+-------+

Sub-Vector Element Type (svet) Field Encoding
=============================================

Encoding chosen for ease of decoding

+-----------------+----------------------------------+
| svet Encoding   | Value                            |
+=================+==================================+
| 0000            | u8                               |
+-----------------+----------------------------------+
| 0001            | u16                              |
+-----------------+----------------------------------+
| 0010            | u32                              |
+-----------------+----------------------------------+
| 0011            | u64                              |
+-----------------+----------------------------------+
| 0100            | i8                               |
+-----------------+----------------------------------+
| 0101            | i16                              |
+-----------------+----------------------------------+
| 0110            | i32                              |
+-----------------+----------------------------------+
| 0111            | i64                              |
+-----------------+----------------------------------+
| 1000            | *Reserved*                       |
+-----------------+----------------------------------+
| 1001            | f16                              |
+-----------------+----------------------------------+
| 1010            | f32                              |
+-----------------+----------------------------------+
| 1011            | f64                              |
+-----------------+----------------------------------+
| 1100            | u128                             |
+-----------------+----------------------------------+
| 1101            | i128                             |
+-----------------+----------------------------------+
| 1110            | f128                             |
+-----------------+----------------------------------+
| 1111            | *Reserved*                       |
+-----------------+----------------------------------+

vs#/vd Fields' Encoding
=======================

+--------+----------+----------------------------------------------------------+
| vs#/vd | Mnemonic | Meaning                                                  |
+========+==========+==========================================================+
| 0      | S        | the rs#/rd field specifies a scalar (single sub-vector)  |
+--------+----------+----------------------------------------------------------+
| 1      | V        | the rs#/rd field specifies a vector                      |
+--------+----------+----------------------------------------------------------+

If a vs#/vd field is not present, it is as if it was present with a value that
is the bitwise-or of all present vs#/vd fields.

Instruction Format
==================

All format names are prefixed with UIF64 (Uniform Instruction Format 64-bit).

All reserved values must be 0.

TODO: add immediates to UIF64I and add missing formats

Bits 49:46 are chosen so the vectorizing unit just has to check those 4 bits to
know if vectorizing is needed and which fields to increment.

+----------+---------+----+----+----+----+----+----+----+----+----+----+----+----+----+------------+------------+------------+------------+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+------------+---------+
| Format   | 63      | 62 | 61 | 60 | 59 | 58 | 57 | 56 | 55 | 54 | 53 | 52 | 51 | 50 | 49         | 48         | 47         | 46         | 45 | 44 | 43 | 42 | 41 | 40 | 39 | 38 | 37 | 36 | 35 | 34 | 33 | 32 | 31 | 30 | 29 | 28 | 27 | 26 | 25 | 24 | 23 | 22 | 21 | 20 | 19 | 18 | 17 | 16 | 15 | 14 | 13 | 12 | 11 | 10 | 9  | 8  | 7          | 6:0     |
+==========+=========+====+====+====+====+====+====+====+====+====+====+====+====+====+============+============+============+============+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+====+============+=========+
| UIF64ST  | imm[11:8]              | Opcode            | svet              | svlen   | *Reserved* | vs2        | vs1        | *Reserved* | pred                        | rstride                               | rs2                                   | rs1                                   | imm[7:0]                              | *Reserved* | 0111111 |
+----------+                        +                   +                   +         +            +------------+            +------------+                             +                                       +----+----+----+----+----+----+----+----+                                       +----+----+----+----+----+----+----+----+            +---------+
| UIF64LD  |                        |                   |                   |         |            | *Reserved* |            | vd         |                             |                                       | imm[7:0]                              |                                       | rd                                    |            | 0111111 |
+----------+                        +                   +                   +         +            +------------+            +------------+                             +----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+                                       +----+----+----+----+----+----+----+----+            +---------+
| UIF64STI |                        |                   |                   |         |            | vs2        |            | *Reserved* |                             | immstride                             | rs2                                   |                                       | imm[7:0]                              |            | 0111111 |
+----------+                        +                   +                   +         +            +------------+            +------------+                             +                                       +----+----+----+----+----+----+----+----+                                       +----+----+----+----+----+----+----+----+            +---------+
| UIF64LDI |                        |                   |                   |         |            | *Reserved* |            | vd         |                             |                                       | imm[7:0]                              |                                       | rd                                    |            | 0111111 |
+----------+---------+----+----+----+----+----+----+----+                   +         +------------+------------+            +            +                             +----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+                                       +                                       +            +---------+
| UIF64R4  | Opcode                                     |                   |         | vs3        | vs2        |            |            |                             | rs3                                   | rs2                                   |                                       |                                       |            | 0111111 |
+----------+                                            +                   +         +------------+            +            +            +                             +----+----+----+----+----+----+----+----+                                       +                                       +                                       +            +---------+
| UIF64R   |                                            |                   |         | *Reserved* |            |            |            |                             | *Reserved*                            |                                       |                                       |                                       |            | 0111111 |
+----------+---------+----+----+----+----+----+----+----+                   +         +            +------------+            +            +                             +                                       +----+----+----+----+----+----+----+----+                                       +                                       +            +---------+
| UIF64I   | imm[11] | Opcode                           |                   |         |            | *Reserved* |            |            |                             |                                       | *Reserved*                            |                                       |                                       |            | 0111111 |
+----------+---------+                                  +                   +         +            +            +------------+            +                             +----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+                                       +            +---------+
| UIF64U   | imm[36] |                                  |                   |         |            |            | *Reserved* |            |                             | imm[35:12]                                                                                                            |                                       |            | 0111111 |
+----------+---------+----+----+----+----+----+----+----+                   +         +            +            +            +------------+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+                                       +            +---------+
| UIF64LI  | imm[31:30]   | Opcode                      |                   |         |            |            |            | *Reserved* | imm[29:0]                                                                                                                                           |                                       |            | 0111111 |
+----------+---------+----+----+----+----+----+----+----+----+----+----+----+----+----+------------+------------+------------+------------+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+------------+---------+
